{% extends 'smvs/layout.html' %}

{% block body %}

    {% for election in elections %}
        {% if user.is_authenticated and user.is_superuser %}
            The election id is: {{ election.id }}
        {% endif %}
        <div class="container">
            <div class="row mt-5">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h4>Candidate</h4>
                        </div>
                        <div class="card-body">
                            {% for candidate in election.candidates.all %}
                                <img src="{{ candidate.profile_picture.url }}" alt="Profile picture of {{ candidate.first_name }}" width="60%">
                                <p class="card-text">
                                    <strong>Name: {{ candidate.full_name }}</strong> <span id="voter-name"></span>
                                </p>
                                <p class="card-text">
                                    <strong>Party: {{ candidate.party_affiliation }}</strong> <span id="voter-age"></span>
                                </p>
                                {% if user.id not in user_votes  %}
                                        <form action="{% url 'vote_submit' %}" method="post">
                                            {% csrf_token %}
                                            <input type="hidden" name="candidate_id" value="{{ candidate.id }}">
                                            <input class="btn btn-primary" id="submitbutton" type="submit" value="Vote">
                                        </form>
                                    {% else %}
                                        <h3>You have already Voted</h3>
                                {% endif %}
                            {% endfor %}
                            <p class="card-text">
                                <strong>Votes: {{ votes }}</strong> <span id="voter-age"></span>
                            </p>
                            <form action="{%url 'index'%}">
                                {% csrf_token %}
                                <input type="submit" value="Home">
                            </form>
                        </div>
                    </div>
                </div>
                <!--<div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h4>Candidates</h4>
                        </div>
                        <div class="card-body">
                            <div id="candidate-list"></div>
                        </div>
                    </div>
                </div>-->
            </div>
        </div>
        <style>
            body {
                font-family: Arial, sans-serif;
                background-color: #f8f9fa;
            }
        </style>
        <script>
            // Voter details (replace with actual data)
      
            // Candidates (replace with actual data)
        
            // Populate voter details
            document.getElementById("voter-name").textContent = voterName;
            document.getElementById("voter-age").textContent = voterAge;
            document.getElementById("voter-id").textContent = voterId;
    
            // Populate candidate list
            const candidateList = document.getElementById("candidate-list");
            candidates.forEach(candidate => {
                const candidateCard = document.createElement("div");
                candidateCard.classList.add("card", "mb-3");
    
                const candidateCardBody = document.createElement("div");
                candidateCardBody.classList.add("card-body");
    
                const row = document.createElement("div");
                row.classList.add("row");
    
                const colImage = document.createElement("div");
                colImage.classList.add("col-md-3");
    
                const candidateImage = document.createElement("img");
                candidateImage.src = candidate.image;
                candidateImage.alt = `${candidate.name} Profile Photo`;
                candidateImage.classList.add("img-fluid", "rounded-circle");
                colImage.appendChild(candidateImage);
    
                const colDetails = document.createElement("div");
                colDetails.classList.add("col-md-9");
    
                const candidateName = document.createElement("h5");
                candidateName.classList.add("card-title");
                candidateName.textContent = candidate.name;
    
                const candidateAge = document.createElement("p");
                candidateAge.classList.add("card-text");
                candidateAge.textContent = `Age: ${candidate.age}`;
    
                const candidateDescription = document.createElement("p");
                candidateDescription.classList.add("card-text");
                candidateDescription.textContent = candidate.description;
    
                const voteButton = document.createElement("button");
                voteButton.classList.add("btn", "btn-primary");
                voteButton.textContent = "Vote";
                voteButton.addEventListener("click", () => {
                    alert(`You voted for ${candidate.name}`);
                    voteButton.disabled = true;
                    const otherButtons = document.querySelectorAll(".btn-primary:not(:disabled)");
                    otherButtons.forEach(button => button.disabled = true);
                });
    
                colDetails.appendChild(candidateName);
                colDetails.appendChild(candidateAge);
                colDetails.appendChild(candidateDescription);
                colDetails.appendChild(voteButton);
    
                row.appendChild(colImage);
                row.appendChild(colDetails);
    
                candidateCardBody.appendChild(row);
                candidateCard.appendChild(candidateCardBody);
    
                candidateList.appendChild(candidateCard);
            });
        </script>
    {% endfor %}

{% endblock %}
